--üì¶ SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")
local player = Players.LocalPlayer

--üì° REMOTES
local ReplicaSignal = ReplicatedStorage:WaitForChild("ReplicaRemoteEvents"):WaitForChild("Replica_ReplicaSignal")
local HatchRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Eggs"):WaitForChild("Hatch")
local SpinWheel = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SpinWheel")
local RedeemRemote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("RedeemCode")

--üîÅ FLAGS
local toggles = {
    autoTap = false,
    autoHatch = false,
    autoGifts = false,
    autoSpin = false,
    antiAFK = false,
}

--ü•ö EGGS
local eggList = { "Basic", "Bird", "100K", "Beach", "Winter", "Magma", "Heaven", "Space" }
local selectedEgg = eggList[1]

--üîß FUNCTIONS
local function autoTap()
    while toggles.autoTap do
        ReplicaSignal:FireServer(2, "Tap")
        task.wait()
    end
end

local function autoHatch()
    while toggles.autoHatch do
        HatchRemote:InvokeServer(selectedEgg, 13)
        task.wait()
    end
end

local function autoClaimGifts()
    while toggles.autoGifts do
        for i = 1, 12 do
            ReplicaSignal:FireServer(2, "ClaimGift", "Gift" .. i)
            task.wait(0.2)
        end
        task.wait(5)
    end
end

local function autoSpin()
    while toggles.autoSpin do
        pcall(function()
            SpinWheel:InvokeServer()
        end)
        task.wait(5)
    end
end

local function antiAFK()
    while toggles.antiAFK do
        player.Idled:Wait()
        pcall(function()
            VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
            task.wait(1)
            VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        end)
    end
end

local function redeemCodes()
    local codes = { "scramble", "SecretChat", "FlagsBoxes", "Release", "Sorry", "Shutdown", "HeavenArea" }
    for _, code in ipairs(codes) do
        pcall(function()
            RedeemRemote:InvokeServer(code)
        end)
        task.wait(1)
    end
end

task.spawn(redeemCodes)

--üìê GUI SETUP
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "AutoFarmUI"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Position = UDim2.new(0.5, -150, 0.5, -250)
Frame.Size = UDim2.new(0, 300, 0, 500)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Selectable = true

--üõë CLOSE & MINIMIZE
local closeBtn = Instance.new("TextButton", Frame)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.Text = "X"
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

local minimizeBtn = Instance.new("TextButton", Frame)
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -70, 0, 5)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)

local minimized = false

--üîò BUTTONS
local options = {
    {name = "Auto Tap", flag = "autoTap", func = autoTap},
    {name = "Auto Hatch", flag = "autoHatch", func = autoHatch},
    {name = "Claim Gifts", flag = "autoGifts", func = autoClaimGifts},
    {name = "Spin Wheel", flag = "autoSpin", func = autoSpin},
    {name = "Anti AFK", flag = "antiAFK", func = antiAFK},
}

for i, opt in ipairs(options) do
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(0, 260, 0, 40)
    btn.Position = UDim2.new(0, 20, 0, 40 + (i - 1) * 45)
    btn.Text = opt.name .. " [OFF]"
    btn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)

    btn.MouseButton1Click:Connect(function()
        toggles[opt.flag] = not toggles[opt.flag]
        btn.Text = opt.name .. (toggles[opt.flag] and " [ON]" or " [OFF]")
        if toggles[opt.flag] then
            task.spawn(opt.func)
        end
    end)
end

--ü•ö EGG SELECT SETUP
local eggLabel = Instance.new("TextLabel", Frame)
eggLabel.Size = UDim2.new(0, 260, 0, 30)
eggLabel.Position = UDim2.new(0, 20, 0, 40 + (#options * 45))
eggLabel.Text = "Selected Egg: " .. selectedEgg
eggLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
eggLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 45)

local dropdownBtn = Instance.new("TextButton", Frame)
dropdownBtn.Size = UDim2.new(0, 260, 0, 30)
dropdownBtn.Position = eggLabel.Position + UDim2.new(0, 0, 0, 35)
dropdownBtn.Text = "Choose Egg"
dropdownBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
dropdownBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

local dropFrame = Instance.new("Frame", Frame)
dropFrame.Position = dropdownBtn.Position + UDim2.new(0, 0, 0, 35)
dropFrame.Size = UDim2.new(0, 260, 0, #eggList * 25)
dropFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
dropFrame.BorderSizePixel = 1
dropFrame.ZIndex = 10
dropFrame.Visible = false

--üî• Add options dynamically
for i, eggName in ipairs(eggList) do
    local optBtn = Instance.new("TextButton", dropFrame)
    optBtn.Size = UDim2.new(1, 0, 0, 25)
    optBtn.Position = UDim2.new(0, 0, 0, (i - 1) * 25)
    optBtn.Text = eggName
    optBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
    optBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    optBtn.ZIndex = 11

    optBtn.MouseButton1Click:Connect(function()
        selectedEgg = eggName
        eggLabel.Text = "Selected Egg: " .. selectedEgg
        dropFrame.Visible = false
    end)
end

--üõéÔ∏è Toggle dropdown visibility
dropdownBtn.MouseButton1Click:Connect(function()
    dropFrame.Visible = not dropFrame.Visible
end)



-- Minimize logic
local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        Frame.Size = UDim2.new(0, 300, 0, 40)
        for _, child in ipairs(Frame:GetChildren()) do
            if child ~= closeBtn and child ~= minimizeBtn then
                child.Visible = false
            end
        end
        dropFrame.Visible = false
    else
        Frame.Size = UDim2.new(0, 300, 0, 40 + (#options * 45) + 30 + 35 + 40)
        for _, child in ipairs(Frame:GetChildren()) do
            child.Visible = true
        end
    end
end)

--üñ±Ô∏è DRAGGING SUPPORT
local dragging, dragInput, dragStart, startPos

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)
